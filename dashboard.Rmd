---
title: "Flex Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE, cache=TRUE}
library(flexdashboard)
library(tidyverse)
library(viridis)
library(rnoaa)
library(plotly)

stations <- ghcnd_stations()

stations %>% 
  filter(state == "NY", name == "BUFFALO") %>% 
  group_by(id) %>% 
  summarise(ly = max(last_year),
            min = min(first_year))

stations %>% 
  filter(state == "NY", str_detect(name, "ALBANY")) %>% 
  group_by(id) %>% 
  summarise(ly = max(last_year),
            min = min(first_year))

#central park id is USW00094728

nystationids <- c("USW00014733", "USW00014735", "USW00094728")

nydat <- meteo_pull_monitors(nystationids, 
                             date_min = "2018-01-01", 
                             date_max = "2018-12-31", 
                             var = c("PRCP", "SNOW", "SNWD", "TMAX", "TMIN")) %>% 
  mutate(name = recode(id, USW00014733 = "Buffalo_NY",
                       USW00014735 = "Albany_NY",
                       USW00094728 = "CentralPark_NY"),
         tmin = tmin / 10,
         tmax = tmax / 10) %>%
  select(name, id, everything())

```

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}

nydat %>% 
  mutate(text_label = str_c("Date: ", date)) %>%
  plot_ly(
    x = ~tmin, y = ~tmax, type = "scatter", mode = "markers",
    color = ~name, text = ~text_label, alpha = 0.4, size = 6)

```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}

nydat %>% 
  plot_ly(x = ~name, y = ~snow, color = ~name, type = "bar")

```

### Chart C

```{r}

nydat %>% 
  na.omit() %>% 
  plot_ly(y = ~prcp, color = ~name, type = "box")

```

